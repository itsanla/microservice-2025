version: '3.8'

services:
  # ==================== MARKETPLACE API GATEWAY ====================
  marketplace-gateway:
    image: itsanla/marketplace-gateway:latest
    container_name: marketplace-gateway
    ports:
      - "9000:9000"
    environment:
      SPRING_APPLICATION_NAME: API-GATEWAY-MARKETPLACE
      SERVER_PORT: 9000
      EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: http://${EUREKA_IP}:8761/eureka/
      EUREKA_INSTANCE_PREFER_IP_ADDRESS: "true"
      EUREKA_INSTANCE_IP_ADDRESS: ${VPS_GATEWAY_IP}
    networks:
      - gateway-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # ==================== PERPUSTAKAAN API GATEWAY ====================
  perpustakaan-gateway:
    image: itsanla/perpustakaan-gateway:latest
    container_name: perpustakaan-gateway
    ports:
      - "9001:9001"
    environment:
      SPRING_APPLICATION_NAME: API-GATEWAY-PERPUSTAKAAN
      SERVER_PORT: 9001
      EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: http://${EUREKA_IP}:8761/eureka/
      EUREKA_INSTANCE_PREFER_IP_ADDRESS: "true"
      EUREKA_INSTANCE_IP_ADDRESS: ${VPS_GATEWAY_IP}
    networks:
      - gateway-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9001/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  gateway-network:
    driver: bridge
